(function(){function a(a){for(var b=[/for\s*?\((.*?)\)/,/\"(.*?)(\"|$)/,/\'(.*?)(\'|$)/,/\/\*(.*?)(\*\/|$)/,/\/\/.*/],c=[],d=0;b.length>d;d++){var e=0;while(a.length>e){var f=a.substr(e).match(b[d]);if(f==null)break;c.push({start:e+f.index,end:e+f.index+f[0].length}),e+=f.index+Math.max(1,f[0].length)}}return c.sort(function(a,b){return a.start-b.start}),c}function b(a,b){return CodeMirror.innerMode(a.getMode(),a.getTokenAt(b).state).mode}function c(a,b,c,d){var e=a.getMode(),f=a.getLine(b);if(d==null&&(d=f.length),!e.innerMode)return[{from:c,to:d,mode:e}];var g=a.getTokenAt({line:b,ch:c}).state,h=CodeMirror.innerMode(e,g).mode,i=[],j=new CodeMirror.StringStream(f);for(j.pos=j.start=c;;){e.token(j,g);var k=CodeMirror.innerMode(e,g).mode;if(k!=h){var l=j.start;h.name=="xml"&&f.charAt(j.pos-1)==">"&&(l=j.pos),i.push({from:c,to:l,mode:h}),c=l,h=k}if(j.pos>=d)break;j.start=j.pos}return d>c&&i.push({from:c,to:d,mode:h}),i}CodeMirror.extendMode("css",{commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(a){return a.replace(RegExp("(;|\\{|\\})([^\r\n])","g"),"$1\n$2")}}),CodeMirror.extendMode("javascript",{commentStart:"/*",commentEnd:"*/",wordWrapChars:[";","\\{","\\}"],autoFormatLineBreaks:function(b){var c=0,d=/(;|\{|\})([^\r\n;])/g,e=a(b);if(e!=null){for(var f="",g=0;e.length>g;g++)e[g].start>c&&(f+=b.substring(c,e[g].start).replace(d,"$1\n$2"),c=e[g].start),c>=e[g].start&&e[g].end>=c&&(f+=b.substring(c,e[g].end),c=e[g].end);return b.length>c&&(f+=b.substr(c).replace(d,"$1\n$2")),f}return b.replace(d,"$1\n$2")}}),CodeMirror.extendMode("xml",{commentStart:"<!--",commentEnd:"-->",wordWrapChars:[">"],autoFormatLineBreaks:function(a){for(var b=a.split("\n"),c=RegExp("(^\\s*?<|^[^<]*?)(.+)(>\\s*?$|[^>]*?$)"),d=RegExp("<","g"),e=RegExp("(>)([^\r\n])","g"),f=0;b.length>f;f++){var g=b[f].match(c);g!=null&&g.length>3&&(b[f]=g[1]+g[2].replace(d,"\n$&").replace(e,"$1\n$2")+g[3])}return b.join("\n")}}),CodeMirror.defineExtension("commentRange",function(a,c,d){var e=b(this,c),f=this;this.operation(function(){if(a)f.replaceRange(e.commentEnd,d),f.replaceRange(e.commentStart,c),c.line==d.line&&c.ch==d.ch&&f.setCursor(c.line,c.ch+e.commentStart.length);else{var b=f.getRange(c,d),g=b.indexOf(e.commentStart),h=b.lastIndexOf(e.commentEnd);g>-1&&h>-1&&h>g&&(b=b.substr(0,g)+b.substring(g+e.commentStart.length,h)+b.substr(h+e.commentEnd.length)),f.replaceRange(b,c,d)}})}),CodeMirror.defineExtension("autoIndentRange",function(a,b){var c=this;this.operation(function(){for(var d=a.line;b.line>=d;d++)c.indentLine(d,"smart")})}),CodeMirror.defineExtension("autoFormatRange",function(a,b){var d=this;d.operation(function(){for(var e=a.line,f=b.line;f>=e;++e){for(var g={line:e,ch:e==a.line?a.ch:0},h={line:e,ch:e==f?b.ch:null},i=c(d,e,g.ch,h.ch),j="",k=d.getRange(g,h),l=0;i.length>l;++l){var m=i.length>1?k.slice(i[l].from,i[l].to):k;j&&(j+="\n"),j+=i[l].mode.autoFormatLineBreaks?i[l].mode.autoFormatLineBreaks(m):k}if(j!=k){for(var n=0,o=j.indexOf("\n");o!=-1;o=j.indexOf("\n",o+1),++n);d.replaceRange(j,g,h),e+=n,f+=n}}for(var e=a.line+1;f>=e;++e)d.indentLine(e,"smart");d.setSelection(a,d.getCursor(!1))})})})()
